<!DOCTYPE html>
<html>
	<head>
		<title>Table</title>
		<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/css/bootstrap.min.css" rel="stylesheet">
		<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/lg.css">
		<link rel="stylesheet" href="css/backgrid.css" >
		<style>
			.backgrid thead th { text-align: left; }
			.backgrid th, .backgrid td { padding: 5px !important; }
		</style>
	</head>
	<body>
		<nav class="navbar navbar-default" role="navigation">
            <ul class="nav navbar-nav">
                <li><a href="#">Local Ground</a></li>
				<li><a  href="#" id="add_row" style="cursor:pointer;">Add Row</a></li>
            </ul>
        </nav>
		
		<div id="example-2-result" class="backgrid-container"></div>
	
		<script id="deleteTemplate" type="text/template">
			<button class="delete">Delete</button>
		</script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
		<script type="text/javascript" src="js/lib/external/underscore-min.js"></script>
        <script type="text/javascript" src="js/lib/external/backbone-min.js"></script>
		<script type="text/javascript" src="js/lib/external/backgrid.min.js"></script>
		<script type="text/javascript" src="js/lib/external/colResizable-1.3.source.js"></script>
		<script type="text/javascript" src="js/views/table.js"></script>	
		<script>
			$(document).ready(function () {
			
				//http://backgridjs.com/misc/faq.html
				var University = Backbone.Model.extend({
					initialize: function () {
						Backbone.Model.prototype.initialize.apply(this, arguments);
						this.on("change", function (model, options) {
							if (options && options.save === false){ return; }
							model.save();
						});
					}
				});
	
				var Universities = Backbone.Collection.extend({
					model: University,
					url: "http://localground/api/0/forms/9/data/",
					parse : function(response) {
						return response.results;
					}
				});
				
				var DeleteCell = Backgrid.Cell.extend({
					template: _.template('<button class="delete">Delete</button>'),
					events: {
					  "click": "deleteRow"
					},
					deleteRow: function (e) {
						e.preventDefault();
						this.model.destroy();
					},
					render: function () {
						this.$el.html(this.template());
						this.delegateEvents();
						return this;
					}
				});
				
				var universities = new Universities();
				
				var columns = [
					{
						name: "id", 
						label: "ID",
						editable: false,
						// Defines a cell type, and ID is displayed
						// as an integer without the ',' separating 1000s.
						cell: Backgrid.IntegerCell.extend({
							orderSeparator: ''
						})
					},
					{
						name: "delete", 
						label: "delete",
						editable: false,
						cell: DeleteCell
					},
					{
						name: "project_id",
						label: "Project ID",
						cell: "integer" 
					},
					{
						name: "name",
						label: "Name",
						// The cell type can be a reference of a Backgrid.Cell subclass, any Backgrid.Cell subclass instances like *id* above, or a string
						cell: "string" // This is converted to "StringCell" and a corresponding class in the Backgrid package namespace is looked up
					},
					{
						name: "average_gpa",
						label: "Average GPA",
						cell: "number" // An integer cell is a number cell that displays humanized integers
					},
					{
						name: "address",
						label: "Address",
						cell: "string" // A cell type for floating point value, defaults to have a precision 2 decimal numbers
					},
					{
						name: "university_type",
						label: "University Type",
						cell: "string" // A cell type for floating point value, defaults to have a precision 2 decimal numbers
					}
				];
				
				// Initialize a new Grid instance
				var grid = new Backgrid.Grid({
					columns: columns,
					collection: universities
				});
				
				// Render the grid and attach the root to your HTML document
				$("#example-2-result").append(grid.render().el);
			
				// Fetch some countries from the url
				universities.fetch({
					reset: true,
					data: {
						page_size: 100,
						format: 'json'
					}
				});
				
				$("#example-2-result").find('table').addClass('table-bordered');
				$("#example-2-result").find('table').colResizable({ disable: true }); //a hack to run garbage collection for resizable table
				$("#example-2-result").find('table').colResizable({ disable: false });
				
				//http://backgridjs.com/ref/grid.html
				//https://github.com/wyuenho/backgrid/issues/241
				//grid.insertRow([new University(), new University()]);
				$('#add_row').click(function(e) {
					grid.insertRow({
						project_id: 9,
						name: 'A',
						average_gpa: 3.6
					});
					e.preventDefault();
				});			  
			});
			
		</script>
		
	</body>
</html>
