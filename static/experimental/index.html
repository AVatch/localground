<!DOCTYPE html>
<html>
    <head>
        <title>Bootstrap 101 Template</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" media="all" type="text/css" href="/static/css/audio.css">
        <link href="/static/css/twitter/bootstrap.css" rel="stylesheet" media="screen">
    </head>
    <body>
        <h1>Hello, world!</h1>
        <button class="btn primary" type="button" id="launch-modal">Launch modal</button>
        <!-- Modal -->
        <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <!--div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h3 id="myModalLabel">Modal header</h3>
            </div-->
            <div class="modal-body"></div>
        </div>
        <script src="http://code.jquery.com/jquery-latest.js"></script>
        <script src="/static/bootstrap2.2.2/js/bootstrap.min.js"></script>
        <script src="/static/scripts/helpers/namespace.js" type="text/javascript"></script>
        <script src="/static/scripts/site/player.js" type="text/javascript"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
        <script>
            //initialize flash audio player:
            var player = new localground.player();
            player.initialize();

            function generateCarousel(id) {
                var playerHtml = player.renderPlayerObject();
                $('#myModal').find('.modal-body').empty();
                playerHtml.find('input').val('http://localground.org/profile/audio-files/L3N0YXRpYy9tZWRpYS92YW53YXJzL2F1ZGlvL2QzcC1lLm9ha2xhbmRzcG9ydHMuYWxleGlzLm1wMw==/');
                $('#myModal').find('.modal-body').append(
                    $('<div />').addClass('carousel').addClass('slide').attr('id', id)
                        .append(
                            $('<div />').addClass('carousel-inner'))
                        .append(
                            $('<a />').addClass('left carousel-control')
                                .attr('href', '#' + id)
                                .attr('data-slide', 'prev').html('&lsaquo;'))
                        .append(
                            $('<a />').addClass('right carousel-control')
                                .attr('href', '#' + id)
                                .attr('data-slide', 'next').html('&rsaquo;')
                        )
                        .append(
                            $('<div />').addClass('audio-controller')
                                .append(playerHtml)
                        )
                );
            }
            
            $('#launch-modal').click(function(){
                var params = {
                    include_processed_maps: true,
                    include_markers: true,
                    include_audio: true,
                    include_photos: true
                };
                var url = '/api/0/projects/97/';
                $.getJSON(url, params,
                    function(result) {
                        if(!result.success) {
                            alert(result.message);
                            return;
                        }
                        $.each(result.data, function(counter) {
                            if(this.id == 'photo') {
                                //path_medium
                                generateCarousel('c_' + counter);
                                $.each(this.data, function(idx) {
                                    if(idx > 5){ return; }
                                    var $item = $('<div />').addClass('item')
                                            .append($('<img />').attr('src', this.path_large))
                                            .append($('<div />').addClass('carousel-caption')
                                                .append($('<h4 />').html(this.name))
                                                .append($('<p />').html(this.caption))
                                            );
                                    if(idx == 0) { $item.addClass('active'); }
                                    $('#c_' + counter).find('.carousel-inner').append($item);
                                });
                                var $item = $('<div />').addClass('item')
                                            .append($('<div />').css({
                                                height: '450px',
                                                width: '600px',
                                                color: '#fff',
                                                display: 'block',
                                                padding: '30px'
                                            }).html('just a bit of text'))
                                            .append($('<div />').addClass('carousel-caption')
                                                .append($('<h4 />').html('title'))
                                                .append($('<p />').html('caption'))
                                            );
                                $('#c_' + counter).find('.carousel-inner').append($item);
                                $('#c_' + counter).carousel();
                                $('#myModal').modal();
                            }
                        });
                    },
                'json');
                
            });
            

        </script>
        <style>
            .item > img {
                margin-left: auto;
                margin-right: auto;
                /*max-height:300px;*/
                max-height:450px;
            }
            .carousel {
                margin-left: auto;
                margin-right: auto;
                margin-bottom: 0px !important;
                /*height:300px;
                width:400px;*/
                height:450px;
                width:600px;
            }
            .carousel-inner {
                background-color: #999;
            }
            .audio-controller {
                position: absolute;
                width: 190px;
                height: 40px;
                bottom: 5px;
                left: auto;
                right: 5px;
                display: block;
                color: #fff;
                padding: 5px 0px 0px 5px;
            }
            .modal {
                width: 600px;
                margin: -250px 0 0 -300px;
                border: none !important;
                background-color: transparent !important;
                padding: 0px !important;
            }
            #myModal > .modal-body {
                padding: 0px !important;
            }
        </style>
        
        
        <object class="playerpreview" id="myFlash" type="application/x-shockwave-flash" data="/static/scripts/thirdparty/audio-player/player_mp3_js.swf" width="1" height="1">
            <param name="movie" value="/static/scripts/thirdparty/audio-player/player_mp3_js.swf" />
            <param name="AllowScriptAccess" value="always" />
            <param name="FlashVars" value="listener=player&amp;interval=1000" />
        </object>
    </body>
</html>
    
    
